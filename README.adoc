= Boardgamemanager
:sectnums:
:toc:
:icons: font

== Presentation and usage

Boardgamemanager is a web application allowing multiple users to manage collaboratively a catalog of board games.

Once logged in, a user can browse existing registered board games, or add new ones to the catalog.

NOTE: This is a dummy application that has only very basic functionalities!
It's purpose is only to be used for teaching purposes.

== Architecture

Boardgamemanager is architectured as two separate components : the _frontend_ − responsible for the graphical user web interface − and the _backend_ − which contains the real business logic, and receives requests coming from the frontend.
Each of these components is an independent piece of software, and they can be deployed separately.

- The *backend* is developed using the Java language (version 17), and relies on a wide range of Java libraries, such as the https://spring.io/projects/spring-boot[Spring Boot framework] or https://github.com/FasterXML/jackson[Jackson].
All the dependencies are managed automatically using https://maven.apache.org/[Maven].
A PostgreSQL database system is required by the backend to store its data.
- The *frontend* is developed using the TypeScript language, and relies also on a wide range of libraries, such as https://angular.io/[Angular].
All the dependencies are managed automatically using https://www.npmjs.com/[npm].
The frontend must be deployed using a regular web server (such as https://www.nginx.com/[nginx]).
This web server must then both provide the frontend, and act as a proxy to forward requests made by the frontend to the backend.

CAUTION: Since the frontend is purely a graphical web user interface, its code is actually executed in the browser of the user, not on the deployment server.
Then, the frontend (running in the user browser) will send requests to the deployment server in order to reach the backend.
Even though the frontend is not _running_ on the deployment server, do note it must still be _deployed_ on said server using a simple web server.

.Summary of the architecture
image::docs/architecture.drawio.png[align=center]

NOTE: While this figure only shows a single deployment server, it's of course possible to deploy each component (frontend, backend, database) in a different environment.


== Compiling and running the application

=== Running the backend

The backend can be executed in two different modes :

- In *development mode*, the backend does not use a PostgreSQL database system, and instead will use a _fake_ temporary database in memory, which will not be persisted in storage.
This mode is useful for testing purposes.
- In *production mode* the backend runs normally, and requires a PostgreSQL database system to be available and running.

==== In development mode

To *compile and run* the backend in _development mode_ :

- Download the source code.
- Open a terminal and move into the folder containing the source code.
- Run Maven with no options:

```
$ mvn
```

This should start the backend server in development mode, which will then await connections from the frontend.
The 'fake' database will contain random values for testing purposes.

==== In production mode

To *compile* the backend in _production mode_ :

- Download the source code.
- Open a terminal and move into the folder containing the source code.
- Run Maven with the following option:

```
$ mvn package -Pprod
```

This will produce a single file in the location `target/boardgamemanager-0.0.1-SNAPSHOT.jar`.
This file contains the complete backend in an executable format.

Then to *run* the backend in _production mode_, the compiled `.jar` file must be executed with the `java` command using the `-jar` option.
In addition, two environment variables must be set  :

- `SPRING_DATASOURCE_URL` must contain the address that the backend will use to reach the PostgreSQL database system.
It should be written using the following syntax:
+
```
jdbc:postgresql://<database network address>/<database name>`
```
+
where `<database network address>` is a valid network address to reach the database server, and where `<database name>` is the name of the database to use in said system.
+
IMPORTANT: The backend requires the database system to have a single user called `boardgamemanager`, and a single database for this user also called `boardgamemanager`.
+
- `SPRING_LIQUIBASE_URL` must _also_ contain the address to reach the PostgreSQL database system.
This variable can therefore directly use the content of the `SPRING_DATASOURCE_URL` variable.
- `SPRING_DATASOURCE_USERNAME` must contain the user name to use to connect to the database system.
- `SPRING_DATASOURCE_PASSWORD` must contain the password to use to connect to the database system.


Therefore a possible command to start the server in production mode  takes this form:

```
$ SPRING_DATASOURCE_URL="jdbc:postgresql://<database network address>/boardgamemanager" SPRING_LIQUIBASE_URL=$SPRING_DATASOURCE_URL java -jar target/boardgamemanager-0.0.1-SNAPSHOT.jar
```

NOTE: We use here the possibility in a command interpreter to set one or multiple environment variables _just for a single command_.
This is achieved in a single line by first writing `VAR1="VALUE1" VAR2="VALUE2"…` just before the actual command to execute (here starting with `java -jar`).

//TODO database password protection!

Such a command should start the backend server in production mode, which will connect itself to the database system, then await connections from the frontend.
The database will be initially empty.

=== Running the frontend

Same as the backend, the frontend can be executed in two different modes :

- In *development mode*, a small development web server is executed to distribute the frontend.
The frontend will try to access the backend in the same environment as the web server

- In *production mode*, the frontend must be distributed using a proper production-ready web server.
There are some manual tasks required for this mode to work.

Will always try to access the backend on the same machine

If executed in the same environment as the backend, OK

If executed in another environment, need a proxy

TODO